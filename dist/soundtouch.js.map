{"version":3,"file":"soundtouch.js","sources":["../src/FifoSampleBuffer.js","../src/AbstractFifoSamplePipe.js","../src/RateTransposer.js","../src/FilterSupport.js","../src/noop.js","../src/SimpleFilter.js","../src/Stretch.js","../src/testFloatEqual.js","../src/SoundTouch.js","../src/WebAudioBufferSource.js","../src/getWebAudioNode.js","../src/minsSecs.js","../src/PitchShifter.js"],"sourcesContent":["/*\n* SoundTouch JS audio processing library\n* Copyright (c) Olli Parviainen\n* Copyright (c) Ryan Berdeen\n* Copyright (c) Jakub Fiala\n* Copyright (c) Steve 'Cutter' Blades\n*\n* This library is free software; you can redistribute it and/or\n* modify it under the terms of the GNU Lesser General Public\n* License as published by the Free Software Foundation; either\n* version 2.1 of the License, or (at your option) any later version.\n*\n* This library is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n* Lesser General Public License for more details.\n*\n* You should have received a copy of the GNU Lesser General Public\n* License along with this library; if not, write to the Free Software\n* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n*/\n\nexport default class FifoSampleBuffer {\n  constructor() {\n    this._vector = new Float32Array();\n    this._position = 0;\n    this._frameCount = 0;\n  }\n\n  get vector() {\n    return this._vector;\n  }\n\n  get position() {\n    return this._position;\n  }\n\n  get startIndex() {\n    return this._position * 2;\n  }\n\n  get frameCount() {\n    return this._frameCount;\n  }\n\n  get endIndex() {\n    return (this._position + this._frameCount) * 2;\n  }\n\n  clear() {\n    this.receive(this._frameCount);\n    this.rewind();\n  }\n\n  put(numFrames) {\n    this._frameCount += numFrames;\n  }\n\n  putSamples(samples, position, numFrames = 0) {\n    position = position || 0;\n    const sourceOffset = position * 2;\n    if (!(numFrames >= 0)) {\n      numFrames = (samples.length - sourceOffset) / 2;\n    }\n    const numSamples = numFrames * 2;\n\n    this.ensureCapacity(numFrames + this._frameCount);\n\n    const destOffset = this.endIndex;\n    this.vector.set(\n      samples.subarray(sourceOffset, sourceOffset + numSamples),\n      destOffset\n    );\n\n    this._frameCount += numFrames;\n  }\n\n  putBuffer(buffer, position, numFrames = 0) {\n    position = position || 0;\n    if (!(numFrames >= 0)) {\n      numFrames = buffer.frameCount - position;\n    }\n    this.putSamples(buffer.vector, buffer.position + position, numFrames);\n  }\n\n  receive(numFrames) {\n    if (!(numFrames >= 0) || numFrames > this._frameCount) {\n      numFrames = this.frameCount;\n    }\n    this._frameCount -= numFrames;\n    this._position += numFrames;\n  }\n\n  receiveSamples(output, numFrames = 0) {\n    const numSamples = numFrames * 2;\n    const sourceOffset = this.startIndex;\n    output.set(this._vector.subarray(sourceOffset, sourceOffset + numSamples));\n    this.receive(numFrames);\n  }\n\n  extract(output, position = 0, numFrames = 0) {\n    const sourceOffset = this.startIndex + position * 2;\n    const numSamples = numFrames * 2;\n    output.set(this._vector.subarray(sourceOffset, sourceOffset + numSamples));\n  }\n\n  ensureCapacity(numFrames = 0) {\n    const minLength = parseInt(numFrames * 2);\n    if (this._vector.length < minLength) {\n      const newVector = new Float32Array(minLength);\n      newVector.set(this._vector.subarray(this.startIndex, this.endIndex));\n      this._vector = newVector;\n      this._position = 0;\n    } else {\n      this.rewind();\n    }\n  }\n\n  ensureAdditionalCapacity(numFrames = 0) {\n    this.ensureCapacity(this._frameCount + numFrames);\n  }\n\n  rewind() {\n    if (this._position > 0) {\n      this._vector.set(this._vector.subarray(this.startIndex, this.endIndex));\n      this._position = 0;\n    }\n  }\n}\n","/*\n* SoundTouch JS audio processing library\n* Copyright (c) Olli Parviainen\n* Copyright (c) Ryan Berdeen\n* Copyright (c) Jakub Fiala\n* Copyright (c) Steve 'Cutter' Blades\n*\n* This library is free software; you can redistribute it and/or\n* modify it under the terms of the GNU Lesser General Public\n* License as published by the Free Software Foundation; either\n* version 2.1 of the License, or (at your option) any later version.\n*\n* This library is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n* Lesser General Public License for more details.\n*\n* You should have received a copy of the GNU Lesser General Public\n* License along with this library; if not, write to the Free Software\n* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n*/\n\nimport FifoSampleBuffer from './FifoSampleBuffer';\n\nexport default class AbstractFifoSamplePipe {\n  constructor(createBuffers) {\n    if (createBuffers) {\n      this._inputBuffer = new FifoSampleBuffer();\n      this._outputBuffer = new FifoSampleBuffer();\n    } else {\n      this._inputBuffer = this._outputBuffer = null;\n    }\n  }\n\n  get inputBuffer() {\n    return this._inputBuffer;\n  }\n\n  set inputBuffer(inputBuffer) {\n    this._inputBuffer = inputBuffer;\n  }\n\n  get outputBuffer() {\n    return this._outputBuffer;\n  }\n\n  set outputBuffer(outputBuffer) {\n    this._outputBuffer = outputBuffer;\n  }\n\n  clear() {\n    this._inputBuffer.clear();\n    this._outputBuffer.clear();\n  }\n}\n","/*\n* SoundTouch JS audio processing library\n* Copyright (c) Olli Parviainen\n* Copyright (c) Ryan Berdeen\n* Copyright (c) Jakub Fiala\n* Copyright (c) Steve 'Cutter' Blades\n*\n* This library is free software; you can redistribute it and/or\n* modify it under the terms of the GNU Lesser General Public\n* License as published by the Free Software Foundation; either\n* version 2.1 of the License, or (at your option) any later version.\n*\n* This library is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n* Lesser General Public License for more details.\n*\n* You should have received a copy of the GNU Lesser General Public\n* License along with this library; if not, write to the Free Software\n* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n*/\n\nimport AbstractFifoSamplePipe from './AbstractFifoSamplePipe';\n\nexport default class RateTransposer extends AbstractFifoSamplePipe {\n  constructor(createBuffers) {\n    super(createBuffers);\n    this.reset();\n    this._rate = 1;\n  }\n\n  set rate(rate) {\n    this._rate = rate;\n    // TODO: aa filter\n  }\n\n  reset() {\n    this.slopeCount = 0;\n    this.prevSampleL = 0;\n    this.prevSampleR = 0;\n  }\n\n  clone() {\n    const result = new RateTransposer();\n    result.rate = this._rate;\n    return result;\n  }\n\n  process() {\n    // TODO: aa filter\n    const numFrames = this._inputBuffer.frameCount;\n    this._outputBuffer.ensureAdditionalCapacity(numFrames / this._rate + 1);\n    const numFramesOutput = this.transpose(numFrames);\n    this._inputBuffer.receive();\n    this._outputBuffer.put(numFramesOutput);\n  }\n\n  transpose(numFrames = 0) {\n    if (numFrames === 0) {\n      return 0;\n    }\n\n    const src = this._inputBuffer.vector;\n    const srcOffset = this._inputBuffer.startIndex;\n\n    const dest = this._outputBuffer.vector;\n    const destOffset = this._outputBuffer.endIndex;\n\n    let used = 0;\n    let i = 0;\n\n    while (this.slopeCount < 1.0) {\n      dest[destOffset + 2 * i] =\n        (1.0 - this.slopeCount) * this.prevSampleL +\n        this.slopeCount * src[srcOffset];\n      dest[destOffset + 2 * i + 1] =\n        (1.0 - this.slopeCount) * this.prevSampleR +\n        this.slopeCount * src[srcOffset + 1];\n      i = i + 1;\n      this.slopeCount += this._rate;\n    }\n\n    this.slopeCount -= 1.0;\n\n    if (numFrames !== 1) {\n      // eslint-disable-next-line no-constant-condition\n      out: while (true) {\n        while (this.slopeCount > 1.0) {\n          this.slopeCount -= 1.0;\n          used = used + 1;\n          if (used >= numFrames - 1) {\n            break out;\n          }\n        }\n\n        const srcIndex = srcOffset + 2 * used;\n        dest[destOffset + 2 * i] =\n          (1.0 - this.slopeCount) * src[srcIndex] +\n          this.slopeCount * src[srcIndex + 2];\n        dest[destOffset + 2 * i + 1] =\n          (1.0 - this.slopeCount) * src[srcIndex + 1] +\n          this.slopeCount * src[srcIndex + 3];\n\n        i = i + 1;\n        this.slopeCount += this._rate;\n      }\n    }\n\n    this.prevSampleL = src[srcOffset + 2 * numFrames - 2];\n    this.prevSampleR = src[srcOffset + 2 * numFrames - 1];\n\n    return i;\n  }\n}\n","/*\n* SoundTouch JS audio processing library\n* Copyright (c) Olli Parviainen\n* Copyright (c) Ryan Berdeen\n* Copyright (c) Jakub Fiala\n* Copyright (c) Steve 'Cutter' Blades\n*\n* This library is free software; you can redistribute it and/or\n* modify it under the terms of the GNU Lesser General Public\n* License as published by the Free Software Foundation; either\n* version 2.1 of the License, or (at your option) any later version.\n*\n* This library is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n* Lesser General Public License for more details.\n*\n* You should have received a copy of the GNU Lesser General Public\n* License along with this library; if not, write to the Free Software\n* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n*/\n\nexport default class FilterSupport {\n  constructor(pipe) {\n    this._pipe = pipe;\n  }\n\n  get pipe() {\n    return this._pipe;\n  }\n\n  get inputBuffer() {\n    return this._pipe.inputBuffer;\n  }\n\n  get outputBuffer() {\n    return this._pipe.outputBuffer;\n  }\n\n  fillInputBuffer(/*numFrames*/) {\n    throw new Error('fillInputBuffer() not overridden');\n  }\n\n  fillOutputBuffer(numFrames = 0) {\n    while (this.outputBuffer.frameCount < numFrames) {\n      // TODO hardcoded buffer size\n      const numInputFrames = 8192 * 2 - this.inputBuffer.frameCount;\n\n      this.fillInputBuffer(numInputFrames);\n\n      if (this.inputBuffer.frameCount < 8192 * 2) {\n        break;\n        // TODO: flush pipe\n      }\n      this._pipe.process();\n    }\n  }\n\n  clear() {\n    this._pipe.clear();\n  }\n}\n","const noop = function() {\n  return;\n};\n\nexport default noop;\n","/*\n* SoundTouch JS audio processing library\n* Copyright (c) Olli Parviainen\n* Copyright (c) Ryan Berdeen\n* Copyright (c) Jakub Fiala\n* Copyright (c) Steve 'Cutter' Blades\n*\n* This library is free software; you can redistribute it and/or\n* modify it under the terms of the GNU Lesser General Public\n* License as published by the Free Software Foundation; either\n* version 2.1 of the License, or (at your option) any later version.\n*\n* This library is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n* Lesser General Public License for more details.\n*\n* You should have received a copy of the GNU Lesser General Public\n* License along with this library; if not, write to the Free Software\n* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n*/\n\nimport FilterSupport from './FilterSupport';\nimport noop from './noop';\n\nexport default class SimpleFilter extends FilterSupport {\n  constructor(sourceSound, pipe, callback = noop) {\n    super(pipe);\n    this.callback = callback;\n    this.sourceSound = sourceSound;\n    //this.bufferDuration = sourceSound.buffer.duration;\n    this.historyBufferSize = 22050;\n    this._sourcePosition = 0;\n    this.outputBufferPosition = 0;\n    this._position = 0;\n  }\n\n  get position() {\n    return this._position;\n  }\n\n  set position(position) {\n    if (position > this._position) {\n      throw new RangeError(\n        'New position may not be greater than current position'\n      );\n    }\n    const newOutputBufferPosition =\n      this.outputBufferPosition - (this._position - position);\n    if (newOutputBufferPosition < 0) {\n      throw new RangeError('New position falls outside of history buffer');\n    }\n    this.outputBufferPosition = newOutputBufferPosition;\n    this._position = position;\n  }\n\n  get sourcePosition() {\n    return this._sourcePosition;\n  }\n\n  set sourcePosition(sourcePosition) {\n    this.clear();\n    this._sourcePosition = sourcePosition;\n  }\n\n  onEnd() {\n    this.callback();\n  }\n\n  fillInputBuffer(numFrames = 0) {\n    const samples = new Float32Array(numFrames * 2);\n    const numFramesExtracted = this.sourceSound.extract(\n      samples,\n      numFrames,\n      this._sourcePosition\n    );\n    this._sourcePosition += numFramesExtracted;\n    this.inputBuffer.putSamples(samples, 0, numFramesExtracted);\n  }\n\n  extract(target, numFrames = 0) {\n    this.fillOutputBuffer(this.outputBufferPosition + numFrames);\n\n    const numFramesExtracted = Math.min(\n      numFrames,\n      this.outputBuffer.frameCount - this.outputBufferPosition\n    );\n    this.outputBuffer.extract(\n      target,\n      this.outputBufferPosition,\n      numFramesExtracted\n    );\n\n    const currentFrames = this.outputBufferPosition + numFramesExtracted;\n    this.outputBufferPosition = Math.min(this.historyBufferSize, currentFrames);\n    this.outputBuffer.receive(\n      Math.max(currentFrames - this.historyBufferSize, 0)\n    );\n\n    this._position += numFramesExtracted;\n    return numFramesExtracted;\n  }\n\n  handleSampleData(event) {\n    this.extract(event.data, 4096);\n  }\n\n  clear() {\n    super.clear();\n    this.outputBufferPosition = 0;\n  }\n}\n","/*\n* SoundTouch JS audio processing library\n* Copyright (c) Olli Parviainen\n* Copyright (c) Ryan Berdeen\n* Copyright (c) Jakub Fiala\n* Copyright (c) Steve 'Cutter' Blades\n*\n* This library is free software; you can redistribute it and/or\n* modify it under the terms of the GNU Lesser General Public\n* License as published by the Free Software Foundation; either\n* version 2.1 of the License, or (at your option) any later version.\n*\n* This library is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n* Lesser General Public License for more details.\n*\n* You should have received a copy of the GNU Lesser General Public\n* License along with this library; if not, write to the Free Software\n* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n*/\n\nimport AbstractFifoSamplePipe from './AbstractFifoSamplePipe';\n\n/**\n * Giving this value for the sequence length sets automatic parameter value\n * according to tempo setting (recommended)\n */\nconst USE_AUTO_SEQUENCE_LEN = 0;\n\n/**\n * Default length of a single processing sequence, in milliseconds. This determines to how\n * long sequences the original sound is chopped in the time-stretch algorithm.\n *\n * The larger this value is, the lesser sequences are used in processing. In principle\n * a bigger value sounds better when slowing down tempo, but worse when increasing tempo\n * and vice versa.\n *\n * Increasing this value reduces computational burden and vice versa.\n */\n//const DEFAULT_SEQUENCE_MS = 130\nconst DEFAULT_SEQUENCE_MS = USE_AUTO_SEQUENCE_LEN;\n\n/**\n * Giving this value for the seek window length sets automatic parameter value\n * according to tempo setting (recommended)\n */\nconst USE_AUTO_SEEKWINDOW_LEN = 0;\n\n/**\n * Seeking window default length in milliseconds for algorithm that finds the best possible\n * overlapping location. This determines from how wide window the algorithm may look for an\n * optimal joining location when mixing the sound sequences back together.\n *\n * The bigger this window setting is, the higher the possibility to find a better mixing\n * position will become, but at the same time large values may cause a \"drifting\" artifact\n * because consequent sequences will be taken at more uneven intervals.\n *\n * If there's a disturbing artifact that sounds as if a constant frequency was drifting\n * around, try reducing this setting.\n *\n * Increasing this value increases computational burden and vice versa.\n */\n//const DEFAULT_SEEKWINDOW_MS = 25;\nconst DEFAULT_SEEKWINDOW_MS = USE_AUTO_SEEKWINDOW_LEN;\n\n/**\n * Overlap length in milliseconds. When the chopped sound sequences are mixed back together,\n * to form a continuous sound stream, this parameter defines over how long period the two\n * consecutive sequences are let to overlap each other.\n *\n * This shouldn't be that critical parameter. If you reduce the DEFAULT_SEQUENCE_MS setting\n * by a large amount, you might wish to try a smaller value on this.\n *\n * Increasing this value increases computational burden and vice versa.\n */\nconst DEFAULT_OVERLAP_MS = 8;\n\n// Table for the hierarchical mixing position seeking algorithm\nconst _SCAN_OFFSETS = [\n  [\n    124,\n    186,\n    248,\n    310,\n    372,\n    434,\n    496,\n    558,\n    620,\n    682,\n    744,\n    806,\n    868,\n    930,\n    992,\n    1054,\n    1116,\n    1178,\n    1240,\n    1302,\n    1364,\n    1426,\n    1488,\n    0\n  ],\n  [\n    -100,\n    -75,\n    -50,\n    -25,\n    25,\n    50,\n    75,\n    100,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0\n  ],\n  [\n    -20,\n    -15,\n    -10,\n    -5,\n    5,\n    10,\n    15,\n    20,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0,\n    0\n  ],\n  [-4, -3, -2, -1, 1, 2, 3, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]\n];\n\n// Adjust tempo param according to tempo, so that variating processing sequence length is used\n// at varius tempo settings, between the given low...top limits\nconst AUTOSEQ_TEMPO_LOW = 0.5; // auto setting low tempo range (-50%)\nconst AUTOSEQ_TEMPO_TOP = 2.0; // auto setting top tempo range (+100%)\n\n// sequence-ms setting values at above low & top tempo\nconst AUTOSEQ_AT_MIN = 125.0;\nconst AUTOSEQ_AT_MAX = 50.0;\nconst AUTOSEQ_K =\n  (AUTOSEQ_AT_MAX - AUTOSEQ_AT_MIN) / (AUTOSEQ_TEMPO_TOP - AUTOSEQ_TEMPO_LOW);\nconst AUTOSEQ_C = AUTOSEQ_AT_MIN - AUTOSEQ_K * AUTOSEQ_TEMPO_LOW;\n\n// seek-window-ms setting values at above low & top tempo\nconst AUTOSEEK_AT_MIN = 25.0;\nconst AUTOSEEK_AT_MAX = 15.0;\nconst AUTOSEEK_K =\n  (AUTOSEEK_AT_MAX - AUTOSEEK_AT_MIN) / (AUTOSEQ_TEMPO_TOP - AUTOSEQ_TEMPO_LOW);\nconst AUTOSEEK_C = AUTOSEEK_AT_MIN - AUTOSEEK_K * AUTOSEQ_TEMPO_LOW;\n\nexport default class Stretch extends AbstractFifoSamplePipe {\n  constructor(createBuffers) {\n    super(createBuffers);\n    this._quickSeek = true;\n    this.midBufferDirty = false;\n\n    this.midBuffer = null;\n    this.overlapLength = 0;\n\n    this.autoSeqSetting = true;\n    this.autoSeekSetting = true;\n\n    this._tempo = 1;\n    this.setParameters(\n      44100,\n      DEFAULT_SEQUENCE_MS,\n      DEFAULT_SEEKWINDOW_MS,\n      DEFAULT_OVERLAP_MS\n    );\n  }\n\n  clear() {\n    super.clear();\n    this.clearMidBuffer();\n  }\n\n  clearMidBuffer() {\n    if (this.midBufferDirty) {\n      this.midBufferDirty = false;\n      this.midBuffer = null;\n    }\n  }\n\n  /**\n   * Sets routine control parameters. These control are certain time constants\n   * defining how the sound is stretched to the desired duration.\n   *\n   * 'sampleRate' = sample rate of the sound\n   * 'sequenceMS' = one processing sequence length in milliseconds (default = 82 ms)\n   * 'seekwindowMS' = seeking window length for scanning the best overlapping\n   *      position (default = 28 ms)\n   * 'overlapMS' = overlapping length (default = 12 ms)\n   */\n  setParameters(sampleRate, sequenceMs, seekWindowMs, overlapMs) {\n    // accept only positive parameter values - if zero or negative, use old values instead\n    if (sampleRate > 0) {\n      this.sampleRate = sampleRate;\n    }\n\n    if (overlapMs > 0) {\n      this.overlapMs = overlapMs;\n    }\n\n    if (sequenceMs > 0) {\n      this.sequenceMs = sequenceMs;\n      this.autoSeqSetting = false;\n    } else {\n      // zero or below, use automatic setting\n      this.autoSeqSetting = true;\n    }\n\n    if (seekWindowMs > 0) {\n      this.seekWindowMs = seekWindowMs;\n      this.autoSeekSetting = false;\n    } else {\n      // zero or below, use automatic setting\n      this.autoSeekSetting = true;\n    }\n\n    this.calculateSequenceParameters();\n\n    this.calculateOverlapLength(this.overlapMs);\n\n    // set tempo to recalculate 'sampleReq'\n    this.tempo = this._tempo;\n  }\n\n  /**\n   * Sets new target tempo. Normal tempo = 'SCALE', smaller values represent slower\n   * tempo, larger faster tempo.\n   */\n  set tempo(newTempo) {\n    let intskip;\n\n    this._tempo = newTempo;\n\n    // Calculate new sequence duration\n    this.calculateSequenceParameters();\n\n    // Calculate ideal skip length (according to tempo value)\n    this.nominalSkip =\n      this._tempo * (this.seekWindowLength - this.overlapLength);\n    this.skipFract = 0;\n    intskip = Math.floor(this.nominalSkip + 0.5);\n\n    // Calculate how many samples are needed in the 'inputBuffer' to process another batch of samples\n    this.sampleReq =\n      Math.max(intskip + this.overlapLength, this.seekWindowLength) +\n      this.seekLength;\n  }\n\n  get tempo() {\n    return this._tempo;\n  }\n\n  get inputChunkSize() {\n    return this.sampleReq;\n  }\n\n  get outputChunkSize() {\n    return (\n      this.overlapLength +\n      Math.max(0, this.seekWindowLength - 2 * this.overlapLength)\n    );\n  }\n\n  /**\n   * Calculates overlapInMsec period length in samples.\n   */\n  calculateOverlapLength(overlapInMsec = 0) {\n    let newOvl;\n\n    // TODO assert(overlapInMsec >= 0);\n    newOvl = (this.sampleRate * overlapInMsec) / 1000;\n    newOvl = newOvl < 16 ? 16 : newOvl;\n\n    // must be divisible by 8\n    newOvl -= newOvl % 8;\n\n    this.overlapLength = newOvl;\n\n    this.refMidBuffer = new Float32Array(this.overlapLength * 2);\n    this.midBuffer = new Float32Array(this.overlapLength * 2);\n  }\n\n  checkLimits(x, mi, ma) {\n    return x < mi ? mi : x > ma ? ma : x;\n  }\n\n  /**\n   * Calculates processing sequence length according to tempo setting\n   */\n  calculateSequenceParameters() {\n    let seq;\n    let seek;\n\n    if (this.autoSeqSetting) {\n      seq = AUTOSEQ_C + AUTOSEQ_K * this._tempo;\n      seq = this.checkLimits(seq, AUTOSEQ_AT_MAX, AUTOSEQ_AT_MIN);\n      this.sequenceMs = Math.floor(seq + 0.5);\n    }\n\n    if (this.autoSeekSetting) {\n      seek = AUTOSEEK_C + AUTOSEEK_K * this._tempo;\n      seek = this.checkLimits(seek, AUTOSEEK_AT_MAX, AUTOSEEK_AT_MIN);\n      this.seekWindowMs = Math.floor(seek + 0.5);\n    }\n\n    // Update seek window lengths\n    this.seekWindowLength = Math.floor(\n      (this.sampleRate * this.sequenceMs) / 1000\n    );\n    this.seekLength = Math.floor((this.sampleRate * this.seekWindowMs) / 1000);\n  }\n\n  /**\n   * Enables/disables the quick position seeking algorithm.\n   */\n  set quickSeek(enable) {\n    this._quickSeek = enable;\n  }\n\n  clone() {\n    const result = new Stretch();\n    result.tempo = this._tempo;\n    result.setParameters(\n      this.sampleRate,\n      this.sequenceMs,\n      this.seekWindowMs,\n      this.overlapMs\n    );\n    return result;\n  }\n\n  /**\n   * Seeks for the optimal overlap-mixing position.\n   */\n  seekBestOverlapPosition() {\n    return this._quickSeek\n      ? this.seekBestOverlapPositionStereoQuick()\n      : this.seekBestOverlapPositionStereo();\n  }\n\n  /**\n   * Seeks for the optimal overlap-mixing position. The 'stereo' version of the\n   * routine\n   *\n   * The best position is determined as the position where the two overlapped\n   * sample sequences are 'most alike', in terms of the highest cross-correlation\n   * value over the overlapping period\n   */\n  seekBestOverlapPositionStereo() {\n    let bestOffset;\n    let bestCorrelation;\n    let correlation;\n    let i = 0;\n\n    // Slopes the amplitudes of the 'midBuffer' samples\n    this.preCalculateCorrelationReferenceStereo();\n\n    bestOffset = 0;\n    bestCorrelation = Number.MIN_VALUE;\n\n    // Scans for the best correlation value by testing each possible position over the permitted range\n    for (; i < this.seekLength; i = i + 1) {\n      // Calculates correlation value for the mixing position corresponding to 'i'\n      correlation = this.calculateCrossCorrelationStereo(\n        2 * i,\n        this.refMidBuffer\n      );\n\n      // Checks for the highest correlation value\n      if (correlation > bestCorrelation) {\n        bestCorrelation = correlation;\n        bestOffset = i;\n      }\n    }\n\n    return bestOffset;\n  }\n\n  /**\n   * Seeks for the optimal overlap-mixing position. The 'stereo' version of the\n   * routine\n   *\n   * The best position is determined as the position where the two overlapped\n   * sample sequences are 'most alike', in terms of the highest cross-correlation\n   * value over the overlapping period\n   */\n  seekBestOverlapPositionStereoQuick() {\n    let bestOffset;\n    let bestCorrelation;\n    let correlation;\n    let scanCount = 0;\n    let correlationOffset;\n    let tempOffset;\n\n    // Slopes the amplitude of the 'midBuffer' samples\n    this.preCalculateCorrelationReferenceStereo();\n\n    bestCorrelation = Number.MIN_VALUE;\n    bestOffset = 0;\n    correlationOffset = 0;\n    tempOffset = 0;\n\n    // Scans for the best correlation value using four-pass hierarchical search.\n    //\n    // The look-up table 'scans' has hierarchical position adjusting steps.\n    // In first pass the routine searhes for the highest correlation with\n    // relatively coarse steps, then rescans the neighbourhood of the highest\n    // correlation with better resolution and so on.\n    for (; scanCount < 4; scanCount = scanCount + 1) {\n      let j = 0;\n      while (_SCAN_OFFSETS[scanCount][j]) {\n        tempOffset = correlationOffset + _SCAN_OFFSETS[scanCount][j];\n        if (tempOffset >= this.seekLength) {\n          break;\n        }\n\n        // Calculates correlation value for the mixing position corresponding to 'tempOffset'\n        correlation = this.calculateCrossCorrelationStereo(\n          2 * tempOffset,\n          this.refMidBuffer\n        );\n\n        // Checks for the highest correlation value\n        if (correlation > bestCorrelation) {\n          bestCorrelation = correlation;\n          bestOffset = tempOffset;\n        }\n        j = j + 1;\n      }\n      correlationOffset = bestOffset;\n    }\n\n    return bestOffset;\n  }\n\n  /**\n   * Slopes the amplitude of the 'midBuffer' samples so that cross correlation\n   * is faster to calculate\n   */\n  preCalculateCorrelationReferenceStereo() {\n    let i = 0;\n    let context;\n    let temp;\n\n    for (; i < this.overlapLength; i = i + 1) {\n      temp = i * (this.overlapLength - i);\n      context = i * 2;\n      this.refMidBuffer[context] = this.midBuffer[context] * temp;\n      this.refMidBuffer[context + 1] = this.midBuffer[context + 1] * temp;\n    }\n  }\n\n  calculateCrossCorrelationStereo(mixingPosition, compare) {\n    const mixing = this._inputBuffer.vector;\n    mixingPosition += this._inputBuffer.startIndex;\n\n    let correlation = 0;\n    let i = 2;\n    const calcLength = 2 * this.overlapLength;\n    let mixingOffset;\n\n    for (; i < calcLength; i = i + 2) {\n      mixingOffset = i + mixingPosition;\n      correlation +=\n        mixing[mixingOffset] * compare[i] +\n        mixing[mixingOffset + 1] * compare[i + 1];\n    }\n\n    return correlation;\n  }\n\n  // TODO inline\n  /**\n   * Overlaps samples in 'midBuffer' with the samples in 'pInputBuffer' at position\n   * of 'ovlPos'.\n   */\n  overlap(overlapPosition) {\n    this.overlapStereo(2 * overlapPosition);\n  }\n\n  /**\n   * Overlaps samples in 'midBuffer' with the samples in 'pInput'\n   */\n  overlapStereo(inputPosition) {\n    const input = this._inputBuffer.vector;\n    inputPosition += this._inputBuffer.startIndex;\n\n    const output = this._outputBuffer.vector;\n    const outputPosition = this._outputBuffer.endIndex;\n\n    let i = 0;\n    let context;\n    let tempFrame;\n    const frameScale = 1 / this.overlapLength;\n    let fi;\n    let inputOffset;\n    let outputOffset;\n\n    for (; i < this.overlapLength; i = i + 1) {\n      tempFrame = (this.overlapLength - i) * frameScale;\n      fi = i * frameScale;\n      context = 2 * i;\n      inputOffset = context + inputPosition;\n      outputOffset = context + outputPosition;\n      output[outputOffset + 0] =\n        input[inputOffset + 0] * fi + this.midBuffer[context + 0] * tempFrame;\n      output[outputOffset + 1] =\n        input[inputOffset + 1] * fi + this.midBuffer[context + 1] * tempFrame;\n    }\n  }\n\n  process() {\n    let offset;\n    let temp;\n    let overlapSkip;\n\n    if (this.midBuffer === null) {\n      // if midBuffer is empty, move the first samples of the input stream into it\n      if (this._inputBuffer.frameCount < this.overlapLength) {\n        // wait until we've got the overlapLength samples\n        return;\n      }\n      this.midBuffer = new Float32Array(this.overlapLength * 2);\n      this._inputBuffer.receiveSamples(this.midBuffer, this.overlapLength);\n    }\n\n    // Process samples as long as there are enough samples in 'inputBuffer' to form a processing frame\n    while (this._inputBuffer.frameCount >= this.sampleReq) {\n      // If tempo differs from the normal ('SCALE'), scan for hte best overlapping position\n      offset = this.seekBestOverlapPosition();\n\n      /**\n       * Mix the samples in the 'inputBuffer' at position of 'offset' with the samples in 'midBuffer'\n       * using sliding overlapping\n       * ... first partially overlap with the end of the previous sequence (that's in 'midBuffer')\n       */\n      this._outputBuffer.ensureAdditionalCapacity(this.overlapLength);\n      // FIXME unit?\n      // overlap(uint(offset));\n      this.overlap(Math.floor(offset));\n      this._outputBuffer.put(this.overlapLength);\n\n      // ... then copy sequence samples from 'inputBuffer' to output\n      temp = this.seekWindowLength - 2 * this.overlapLength; // & 0xfffffffe;\n      if (temp > 0) {\n        this._outputBuffer.putBuffer(\n          this._inputBuffer,\n          offset + this.overlapLength,\n          temp\n        );\n      }\n\n      /**\n       * Copies the end of the current sequence from 'inputBuffer' to 'midBuffer' for being mixed with\n       * the beginning of the next processing sequence and so on\n       */\n      // assert(offset + seekWindowLength <= (int)inputBuffer.numSamples());\n      const start =\n        this._inputBuffer.startIndex +\n        2 * (offset + this.seekWindowLength - this.overlapLength);\n      this.midBuffer.set(\n        this._inputBuffer.vector.subarray(start, start + 2 * this.overlapLength)\n      );\n\n      /**\n       * Remove the processed samples from the input buffer. Update the difference between\n       * integer & nominal skip step to 'skipFract' in order to prevent the error from\n       * accumulating over time\n       */\n      this.skipFract += this.nominalSkip; // real skip size\n      overlapSkip = Math.floor(this.skipFract);\n      this.skipFract -= overlapSkip;\n      this._inputBuffer.receive(overlapSkip);\n    }\n  }\n}\n","const testFloatEqual = function(a, b) {\n  return (a > b ? a - b : b - a) > 1e-10;\n};\n\nexport default testFloatEqual;\n","/*\n* SoundTouch JS audio processing library\n* Copyright (c) Olli Parviainen\n* Copyright (c) Ryan Berdeen\n* Copyright (c) Jakub Fiala\n* Copyright (c) Steve 'Cutter' Blades\n*\n* This library is free software; you can redistribute it and/or\n* modify it under the terms of the GNU Lesser General Public\n* License as published by the Free Software Foundation; either\n* version 2.1 of the License, or (at your option) any later version.\n*\n* This library is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n* Lesser General Public License for more details.\n*\n* You should have received a copy of the GNU Lesser General Public\n* License along with this library; if not, write to the Free Software\n* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n*/\n\nimport RateTransposer from './RateTransposer';\nimport Stretch from './Stretch';\nimport FifoSampleBuffer from './FifoSampleBuffer';\nimport testFloatEqual from './testFloatEqual';\n\nexport default class SoundTouch {\n  constructor() {\n    this.transposer = new RateTransposer(false);\n    this.stretch = new Stretch(false);\n\n    this._inputBuffer = new FifoSampleBuffer();\n    this._intermediateBuffer = new FifoSampleBuffer();\n    this._outputBuffer = new FifoSampleBuffer();\n\n    this._rate = 0;\n    this._tempo = 0;\n\n    this.virtualPitch = 1.0;\n    this.virtualRate = 1.0;\n    this.virtualTempo = 1.0;\n\n    this.calculateEffectiveRateAndTempo();\n  }\n\n  clear() {\n    this.transposer.clear();\n    this.stretch.clear();\n  }\n\n  clone() {\n    const result = new SoundTouch();\n    result.rate = this.rate;\n    result.tempo = this.tempo;\n    return result;\n  }\n\n  get rate() {\n    return this._rate;\n  }\n\n  set rate(rate) {\n    this.virtualRate = rate;\n    this.calculateEffectiveRateAndTempo();\n  }\n\n  set rateChange(rateChange) {\n    this._rate = 1.0 + 0.01 * rateChange;\n  }\n\n  get tempo() {\n    return this._tempo;\n  }\n\n  set tempo(tempo) {\n    this.virtualTempo = tempo;\n    this.calculateEffectiveRateAndTempo();\n  }\n\n  set tempoChange(tempoChange) {\n    this.tempo = 1.0 + 0.01 * tempoChange;\n  }\n\n  set pitch(pitch) {\n    this.virtualPitch = pitch;\n    this.calculateEffectiveRateAndTempo();\n  }\n\n  set pitchOctaves(pitchOctaves) {\n    this.pitch = Math.exp(0.69314718056 * pitchOctaves);\n    this.calculateEffectiveRateAndTempo();\n  }\n\n  set pitchSemitones(pitchSemitones) {\n    this.pitchOctaves = pitchSemitones / 12.0;\n  }\n\n  get inputBuffer() {\n    return this._inputBuffer;\n  }\n\n  get outputBuffer() {\n    return this._outputBuffer;\n  }\n\n  calculateEffectiveRateAndTempo() {\n    const previousTempo = this._tempo;\n    const previousRate = this._rate;\n\n    this._tempo = this.virtualTempo / this.virtualPitch;\n    this._rate = this.virtualRate * this.virtualPitch;\n\n    if (testFloatEqual(this._tempo, previousTempo)) {\n      this.stretch.tempo = this._tempo;\n    }\n    if (testFloatEqual(this._rate, previousRate)) {\n      this.transposer.rate = this._rate;\n    }\n\n    if (this._rate > 1.0) {\n      if (this._outputBuffer != this.transposer.outputBuffer) {\n        this.stretch.inputBuffer = this._inputBuffer;\n        this.stretch.outputBuffer = this._intermediateBuffer;\n\n        this.transposer.inputBuffer = this._intermediateBuffer;\n        this.transposer.outputBuffer = this._outputBuffer;\n      }\n    } else {\n      if (this._outputBuffer != this.stretch.outputBuffer) {\n        this.transposer.inputBuffer = this._inputBuffer;\n        this.transposer.outputBuffer = this._intermediateBuffer;\n\n        this.stretch.inputBuffer = this._intermediateBuffer;\n        this.stretch.outputBuffer = this._outputBuffer;\n      }\n    }\n  }\n\n  process() {\n    if (this._rate > 1.0) {\n      this.stretch.process();\n      this.transposer.process();\n    } else {\n      this.transposer.process();\n      this.stretch.process();\n    }\n  }\n}\n","/*\n* SoundTouch JS audio processing library\n* Copyright (c) Olli Parviainen\n* Copyright (c) Ryan Berdeen\n* Copyright (c) Jakub Fiala\n* Copyright (c) Steve 'Cutter' Blades\n*\n* This library is free software; you can redistribute it and/or\n* modify it under the terms of the GNU Lesser General Public\n* License as published by the Free Software Foundation; either\n* version 2.1 of the License, or (at your option) any later version.\n*\n* This library is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n* Lesser General Public License for more details.\n*\n* You should have received a copy of the GNU Lesser General Public\n* License along with this library; if not, write to the Free Software\n* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n*/\n\nexport default class WebAudioBufferSource {\n  constructor(buffer) {\n    this.buffer = buffer;\n    this._position = 0;\n  }\n\n  get dualChannel() {\n    return this.buffer.numberOfChannels > 1;\n  }\n\n  get position() {\n    return this._position;\n  }\n\n  set position(value) {\n    this._position = value;\n  }\n\n  extract(target, numFrames = 0, position = 0) {\n    this.position = position;\n    let left = this.buffer.getChannelData(0);\n    let right = this.dualChannel\n      ? this.buffer.getChannelData(1)\n      : this.buffer.getChannelData(0);\n    let i = 0;\n    for (; i < numFrames; i++) {\n      target[i * 2] = left[i + position];\n      target[i * 2 + 1] = right[i + position];\n    }\n    return Math.min(numFrames, left.length - position);\n  }\n}\n","import noop from './noop';\n/**\n * getWebAudioNode\n *\n * A wrapper to create an AudioNode and apply a filter for frame extraction\n * Copyright (c) Adrian Holovary https://github.com/adrianholovaty\n *\n * @param context - AudioContext\n * @param filter - Object containing an 'extract()' method\n * @param bufferSize - units of sample frames (256, 512, 1024, 2048, 4096, 8192, 16384)\n * @returns {ScriptProcessorNode}\n */\nconst getWebAudioNode = function(\n  context,\n  filter,\n  sourcePositionCallback = noop,\n  bufferSize = 4096\n) {\n  const node = context.createScriptProcessor(bufferSize, 2, 2);\n  const samples = new Float32Array(bufferSize * 2);\n\n  node.onaudioprocess = event => {\n    let left = event.outputBuffer.getChannelData(0);\n    let right = event.outputBuffer.getChannelData(1);\n    let framesExtracted = filter.extract(samples, bufferSize);\n    sourcePositionCallback(filter.sourcePosition);\n    if (framesExtracted === 0) {\n      filter.onEnd();\n    }\n    let i = 0;\n    for (; i < framesExtracted; i++) {\n      left[i] = samples[i * 2];\n      right[i] = samples[i * 2 + 1];\n    }\n  };\n  return node;\n};\n\nexport default getWebAudioNode;\n","const pad = function(n, width, z) {\n  z = z || '0';\n  n = n + '';\n  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\n};\n\nconst minsSecs = function(secs) {\n  const mins = Math.floor(secs / 60);\n  const seconds = secs - mins * 60;\n  return `${mins}:${pad(parseInt(seconds), 2)}`;\n};\n\nexport default minsSecs;\n","/*\n* SoundTouch JS audio processing library\n* Copyright (c) Olli Parviainen\n* Copyright (c) Ryan Berdeen\n* Copyright (c) Jakub Fiala\n* Copyright (c) Steve 'Cutter' Blades\n*\n* This library is free software; you can redistribute it and/or\n* modify it under the terms of the GNU Lesser General Public\n* License as published by the Free Software Foundation; either\n* version 2.1 of the License, or (at your option) any later version.\n*\n* This library is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n* Lesser General Public License for more details.\n*\n* You should have received a copy of the GNU Lesser General Public\n* License along with this library; if not, write to the Free Software\n* Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n*/\n\nimport WebAudioBufferSource from './WebAudioBufferSource';\nimport getWebAudioNode from './getWebAudioNode';\nimport SoundTouch from './SoundTouch';\nimport SimpleFilter from './SimpleFilter';\nimport minsSecs from './minsSecs';\nimport noop from './noop';\n\nconst onUpdate = function(sourcePosition) {\n  const currentTimePlayed = this.timePlayed;\n  const sampleRate = this.sampleRate;\n  this.sourcePosition = sourcePosition;\n  this.timePlayed = sourcePosition / sampleRate;\n  if (currentTimePlayed !== this.timePlayed) {\n    const timePlayed = new CustomEvent('play', {\n      detail: {\n        timePlayed: this.timePlayed,\n        formattedTimePlayed: this.formattedTimePlayed,\n        percentagePlayed: this.percentagePlayed\n      }\n    });\n    this._node.dispatchEvent(timePlayed);\n  }\n};\n\nexport default class PitchShifter {\n  constructor(context, buffer, bufferSize, onEnd = noop) {\n    this._soundtouch = new SoundTouch();\n    const source = new WebAudioBufferSource(buffer);\n    this.timePlayed = 0;\n    this.sourcePosition = 0;\n    this._filter = new SimpleFilter(source, this._soundtouch, onEnd);\n    this._node = getWebAudioNode(\n      context,\n      this._filter,\n      sourcePostion => onUpdate.call(this, sourcePostion),\n      bufferSize\n    );\n    this.tempo = 1;\n    this.rate = 1;\n    this.duration = buffer.duration;\n    this.sampleRate = context.sampleRate;\n    this.listeners = [];\n  }\n\n  get formattedDuration() {\n    return minsSecs(this.duration);\n  }\n\n  get formattedTimePlayed() {\n    return minsSecs(this.timePlayed);\n  }\n\n  get percentagePlayed() {\n    return (\n      (100 * this._filter.sourcePosition) / (this.duration * this.sampleRate)\n    );\n  }\n\n  set percentagePlayed(perc) {\n    this._filter.sourcePosition = parseInt(\n      perc * this.duration * this.sampleRate\n    );\n  }\n\n  get node() {\n    return this._node;\n  }\n\n  set pitch(pitch) {\n    this._soundtouch.pitch = pitch;\n  }\n\n  set pitchSemitones(semitone) {\n    this._soundtouch.pitchSemitones = semitone;\n  }\n\n  set rate(rate) {\n    this._soundtouch.rate = rate;\n  }\n\n  set tempo(tempo) {\n    this._soundtouch.tempo = tempo;\n  }\n\n  connect(toNode) {\n    this._node.connect(toNode);\n  }\n\n  disconnect() {\n    this._node.disconnect();\n  }\n\n  on(eventName, cb) {\n    this.listeners.push({ name: eventName, cb: cb });\n    this._node.addEventListener(eventName, event => cb(event.detail));\n  }\n\n  off(eventName = null) {\n    let listeners = this.listeners;\n    if (eventName) {\n      listeners = listeners.filter(e => e.name === eventName);\n    }\n    listeners.forEach(e => {\n      this._node.removeEventListener(e.name, event => e.cb(event.detail));\n    });\n  }\n}\n"],"names":["FifoSampleBuffer","_vector","Float32Array","_position","_frameCount","receive","rewind","numFrames","samples","position","sourceOffset","length","numSamples","ensureCapacity","destOffset","endIndex","vector","set","subarray","buffer","frameCount","putSamples","output","startIndex","minLength","parseInt","newVector","AbstractFifoSamplePipe","createBuffers","_inputBuffer","_outputBuffer","clear","inputBuffer","outputBuffer","RateTransposer","reset","_rate","slopeCount","prevSampleL","prevSampleR","result","rate","ensureAdditionalCapacity","numFramesOutput","transpose","put","src","srcOffset","dest","used","i","out","srcIndex","FilterSupport","pipe","_pipe","Error","numInputFrames","fillInputBuffer","process","noop","SimpleFilter","sourceSound","callback","historyBufferSize","_sourcePosition","outputBufferPosition","numFramesExtracted","extract","target","fillOutputBuffer","Math","min","currentFrames","max","event","data","RangeError","newOutputBufferPosition","sourcePosition","USE_AUTO_SEQUENCE_LEN","DEFAULT_SEQUENCE_MS","USE_AUTO_SEEKWINDOW_LEN","DEFAULT_SEEKWINDOW_MS","DEFAULT_OVERLAP_MS","_SCAN_OFFSETS","AUTOSEQ_TEMPO_LOW","AUTOSEQ_TEMPO_TOP","AUTOSEQ_AT_MIN","AUTOSEQ_AT_MAX","AUTOSEQ_K","AUTOSEQ_C","AUTOSEEK_AT_MIN","AUTOSEEK_AT_MAX","AUTOSEEK_K","AUTOSEEK_C","Stretch","_quickSeek","midBufferDirty","midBuffer","overlapLength","autoSeqSetting","autoSeekSetting","_tempo","setParameters","clearMidBuffer","sampleRate","sequenceMs","seekWindowMs","overlapMs","calculateSequenceParameters","calculateOverlapLength","tempo","overlapInMsec","newOvl","refMidBuffer","x","mi","ma","seq","seek","checkLimits","floor","seekWindowLength","seekLength","seekBestOverlapPositionStereoQuick","seekBestOverlapPositionStereo","bestOffset","bestCorrelation","correlation","preCalculateCorrelationReferenceStereo","Number","MIN_VALUE","calculateCrossCorrelationStereo","scanCount","correlationOffset","tempOffset","j","context","temp","mixingPosition","compare","mixing","calcLength","mixingOffset","overlapPosition","overlapStereo","inputPosition","input","outputPosition","tempFrame","frameScale","fi","inputOffset","outputOffset","offset","overlapSkip","receiveSamples","sampleReq","seekBestOverlapPosition","overlap","putBuffer","start","skipFract","nominalSkip","newTempo","intskip","enable","testFloatEqual","a","b","SoundTouch","transposer","stretch","_intermediateBuffer","virtualPitch","virtualRate","virtualTempo","calculateEffectiveRateAndTempo","previousTempo","previousRate","rateChange","tempoChange","pitch","pitchOctaves","exp","pitchSemitones","WebAudioBufferSource","left","getChannelData","right","dualChannel","numberOfChannels","value","getWebAudioNode","filter","sourcePositionCallback","bufferSize","node","createScriptProcessor","onaudioprocess","framesExtracted","onEnd","pad","n","width","z","Array","join","minsSecs","secs","mins","seconds","onUpdate","currentTimePlayed","timePlayed","CustomEvent","detail","formattedTimePlayed","percentagePlayed","_node","dispatchEvent","PitchShifter","_soundtouch","source","_filter","sourcePostion","call","duration","listeners","toNode","connect","disconnect","eventName","cb","push","name","addEventListener","e","forEach","removeEventListener","perc","semitone"],"mappings":"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"}